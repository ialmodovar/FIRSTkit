---
title: "One-Sample Inference"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
  extract <- function(text) {
    text <- gsub(" ", "", text)
    split <- strsplit(text, ",", fixed = FALSE)[[1]]
    as.numeric(split)
  }

all.t.one.sample.test <- function(x, mu0 = 0, alpha = 0.05,...){
  twosided <- t.test(x = x, mu = mu0, 
                     alternative = "two.sided",
                     conf.level = 1-alpha)
  oneless <- t.test(x = x, mu = mu0, 
                    alternative = "less",
                    conf.level = 1-alpha)
  onegreater <- t.test(x = x, mu = mu0, 
                       alternative = "greater",
                       conf.level = 1-alpha)
  
tt <- round(c(twosided$statistic, oneless$statistic, onegreater$statistic),digits=3)
pval <- round(c(twosided$p.value, oneless$p.value, onegreater$p.value),digits = 3) 

ci <- c(paste("(",paste(round(twosided$conf.int[1],digits=3),",",
        round(twosided$conf.int[2],digits=3),sep=""),")",sep=""),
        paste("(",paste(round(oneless$conf.int[1],digits=3),",",
                        round(oneless$conf.int[2],digits=3),sep=""),")",sep=""),
        paste("(",paste(round(onegreater$conf.int[1],digits=3),",",
                        round(onegreater$conf.int[2],digits=3),sep=""),")",sep=""))

res <- data.frame(Test = tt,Pval = pval, CI =ci)
names(res) <- c("statistic","p-value",paste(as.character((1-alpha)*100),"% CI",sep=""))

 rownames(res) <- c(paste("H_1: mu = ",mu0,sep=""),
                     paste("H_1: mu < ",mu0,sep=""),
                     paste("H_1: mu > ",mu0,sep=""))
 
res
}

##

all.wilcoxon.one.sample.test <- function(x, mu0 = 0, alpha = 0.05,...){
  twosided <- wilcox.test(x = x, mu = mu0, 
                     alternative = "two.sided",
                     conf.level = 1-alpha,conf.int = TRUE)
  oneless <- wilcox.test(x = x, mu = mu0, 
                         alternative = "less",
                         conf.level = 1-alpha,conf.int = TRUE)
  onegreater <- wilcox.test(x = x, mu = mu0, 
                            alternative = "greater",
                            conf.level = 1-alpha,conf.int = TRUE)
  
  tt <- round(c(twosided$statistic, oneless$statistic, onegreater$statistic),digits=3)
  pval <- round(c(twosided$p.value, oneless$p.value, onegreater$p.value),digits = 3) 
  
  ci <- c(paste("(",paste(round(twosided$conf.int[1],digits=3),",",
                          round(twosided$conf.int[2],digits=3),sep=""),")",sep=""),
          paste("(",paste(round(oneless$conf.int[1],digits=3),",",
                          round(oneless$conf.int[2],digits=3),sep=""),")",sep=""),
          paste("(",paste(round(onegreater$conf.int[1],digits=3),",",
                          round(onegreater$conf.int[2],digits=3),sep=""),")",sep=""))
  
  res <- data.frame(Test = tt,Pval = pval, CI =ci)
  names(res) <- c("statistic","p-value",paste(as.character((1-alpha)*100),"% CI",sep=""))
  
 rownames(res) <- c(paste("H_1: mu = ",mu0,sep=""),
                     paste("H_1: mu < ",mu0,sep=""),
                     paste("H_1: mu > ",mu0,sep=""))
 
res
}

chi2.test <- function(x, sigma0 = 1, conf.level=0.95,alternative=c("two-sided","less","greater")){
  cat("\n Chi-Square Test for the Variance\n \n")
  df <- length(x)-1
  vv <- var(x)
  sigma02 <- sigma0^2
  tstat <- df * vv/sigma02 #test statistics
  alpha <- 1- conf.level # significance level
  alternative <- match.arg(alternative, choices =c("two-sided","less","greater"))
}


```

This *Shiny App* is made with the purpose to be free and educational. It comes without guarantee. You can perform basic statistical inference analysis such as one-sample. The user can perform parametric *t* test as well, $\chi^2$ test for the variance. Note that the argument to perform a one sample test for the variance is in terms of the standard deviation. 

User can also select non-parametric approach. Wilcoxon-signed rank test uses the argument of $\mu_0$, although, this does not represent the mean but rather a location parameter. 


```{r inputs-one-sample, echo=FALSE}

  sidebarLayout(
    sidebarPanel(
     textInput("x", "Data", value = "", placeholder = "Enter values separated by a comma, e.g. 1, 2, 3, etc."),
      textInput("alpha","alpha",value="0.05",placeholder="Significance level"),
     textInput("mu0","Mean",value="0",placeholder="Number indicating the true value of the mean "),
     textInput("sigma0","Standard Deviation",value="1",placeholder="Number indicating the true value of the standard deviation"),
  checkboxInput("upload","Upload file",TRUE),  
                        # Input: Select a file ----
      fileInput("file1", "Choose CSV File",
                multiple = TRUE,
                accept = c("text/csv",
                           "text/comma-separated-values,text/plain",
                           ".csv")),
          # Horizontal line ----
      tags$hr(),
      
      # Input: Checkbox if file has header ----
      checkboxInput("header", "Header", TRUE),
      
      # Input: Select separator ----
      radioButtons("sep", "Separator",
                   choices = c(Comma = ",",
                               Semicolon = ";",
                               Tab = "\t"),
                   selected = ","),
      
        # Input: Select quotes ----
      radioButtons("quote", "Quote",
                   choices = c(None = "",
                               "Double Quote" = '"',
                               "Single Quote" = "'"),
                   selected = '"'),
           # Input: Select number of rows to display ----
      radioButtons("disp", "Display",
                   choices = c(Head = "head",
                               All = "all"),
                   selected = "head")),


                  mainPanel(
                    
                    tabsetPanel(type = "tabs",
                                tabPanel("Data", DT::dataTableOutput('tbldata')), # Data 
                tabPanel("Mean Inference",
                br(),
                tags$b("One Sample t test"),
                uiOutput("mean"),
                br(),
                tags$b("Wilcoxon signed rank test"),
                uiOutput("loc")),
              tabPanel("Variance Inference",uiOutput("variance")),
tabPanel("Proportion Inference",uiOutput("prop"))
                  )
  )
  )

 output$tbldata <- DT::renderDataTable({
    # input$file1 will be NULL initially. After the user selects
    # and uploads a file, head of that data file by default,
    # or all rows if selected, will be shown.
    if(input$upload){
    req(input$file1)
    
    df <- read.csv(input$file1$datapath,
                   header = input$header,
                   sep = input$sep,
                   quote = input$quote)
    } else{
    x <- extract(input$x)
    df <- data.frame(x)
    }
  if(input$disp == "head") {
      return(head(df))
    }
    else {
      return(df)
    }
    df

 })
 
output$mean <- renderTable({
 ## textInput("mu0","Mean",value="0",placeholder="Number indicating the true value of the mean ")
    mu0 <- as.numeric(input$mu0)
    alpha <- as.numeric(input$alpha)
  
    if(input$upload){
    req(input$file1)
    
    df <- read.csv(input$file1$datapath,
                   header = input$header,
                   sep = input$sep,
                   quote = input$quote)
    } else{
    x <- extract(input$x)
    df <- data.frame(x)
    }
   all.t.one.sample.test(x = x, mu0 = mu0,alpha = alpha)
},rownames = TRUE)

output$loc <- renderTable({
 ## textInput("mu0","Mean",value="0",placeholder="Number indicating the true value of the mean ")
    mu0 <- as.numeric(input$mu0)
    alpha <- as.numeric(input$alpha)
  
    if(input$upload){
    req(input$file1)
    
    df <- read.csv(input$file1$datapath,
                   header = input$header,
                   sep = input$sep,
                   quote = input$quote)
    } else{
    x <- extract(input$x)
    df <- data.frame(x)
    }
   all.wilcoxon.one.sample.test(x = x, mu0 = mu0,alpha = alpha)
},rownames = TRUE)
  
```


To learn more, see [FIRSTkit](https://github.com/ialmodovar/FIRSTkit). If you have any question or want to report to *israel.almodovar@upr.edu* or *maitra@iastate.edu*. 
