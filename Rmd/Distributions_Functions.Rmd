---
title: "Distribution Functions"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}

library(dplyr)
library(ggplot2)
library(mixdist)
##  withMathJax(),
  sidebarLayout(
    sidebarPanel(
      selectInput(
        inputId = "distribution",
        label = "Distribution:",
        choices = c("Binomial", "Poisson","Chi-square", 
                    "Normal", "Student t","Snedecor F"),
        multiple = FALSE,
        selected = "Normal"
      ),
      hr(),
      conditionalPanel(
        condition = "input.distribution == 'Binomial'",
        numericInput("n_binomial", "Number of trials \\(n\\):",
                     value = 20, min = 0, step = 1),
        numericInput("p_binomial", "Probability of success \\(p\\):",
                     value = 0.5, min = 0, max = 1, step = 0.01)
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square'",
        numericInput("df_chisquare", "Degrees of freedom \\(df\\):",
                     value = 1, min = 1, step = 1)
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal'",
        numericInput("mean_normal", "Mean \\(\\mu\\):",
                     value = 0, step = 1),
        radioButtons(
          inputId = "variance_sd",
          label = NULL,
          choices = c(
            "Variance \\(\\sigma^2\\)" = "variance_true",
            "Standard deviation \\(\\sigma\\)" = "variance_false"
          )
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.variance_sd == 'variance_true'",
        numericInput("variance_normal", "Variance \\(\\sigma^2\\):",
                     value = 1, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.variance_sd == 'variance_false'",
        numericInput("sd_normal", "Standard deviation \\(\\sigma\\):",
                     value = 1, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson'",
        numericInput("lambda_poisson", "Rate \\(\\lambda\\):",
                     value = 1, min = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t'",
        numericInput("df_student", "Degrees of freedom \\(df\\):",
                     value = 10, min = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F'",
        numericInput("df1_f", "Degrees of Freedom (Numerator)",
                     value = 10, min = 1, step = 1
        ),
        numericInput("df2_f", "Degrees of Freedom (Denominator)",
                     value = 10, min = 1, step = 1
        ),
      ),
      conditionalPanel(
        condition = "input.distribution == 'Binomial'",
        radioButtons(
          inputId = "lower_tail_binomial",
          label = NULL,
          choices = c(
            "Lower tail: \\(P(X \\leq x)\\)" = "lower.tail",
            "Upper tail: \\(P(X > x)\\)" = "upper.tail",
            "Interval: \\(P(a \\leq X \\leq b)\\)" = "interval"
          )
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square'",
        radioButtons(
          inputId = "lower_tail_chisquare",
          label = NULL,
          choices = c(
            "Lower tail: \\(P(X \\leq x)\\)" = "lower.tail",
            "Upper tail: \\(P(X > x)\\)" = "upper.tail",
            "Interval: \\(P(a \\leq X \\leq b)\\)" = "interval"
          )
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal'",
        radioButtons(
          inputId = "lower_tail_normal",
          label = NULL,
          choices = c(
            "Lower tail: \\(P(X \\leq x)\\)" = "lower.tail",
            "Upper tail: \\(P(X > x)\\)" = "upper.tail",
            "Interval: \\(P(a \\leq X \\leq b)\\)" = "interval"
          )
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson'",
        radioButtons(
          inputId = "lower_tail_poisson",
          label = NULL,
          choices = c(
            "Lower tail: \\(P(X \\leq x)\\)" = "lower.tail",
            "Upper tail: \\(P(X > x)\\)" = "upper.tail",
            "Interval: \\(P(a \\leq X \\leq b)\\)" = "interval"
          )
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t'",
        radioButtons(
          inputId = "lower_tail_student",
          label = NULL,
          choices = c(
            "Lower tail: \\(P(X \\leq x)\\)" = "lower.tail",
            "Upper tail: \\(P(X > x)\\)" = "upper.tail",
            "Interval: \\(P(a \\leq X \\leq b)\\)" = "interval"
          )
        )
      ),
      
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F'",
        radioButtons(
          inputId = "lower_tail_f",
          label = NULL,
          choices = c(
            "Lower tail: \\(P(X \\leq x)\\)" = "lower.tail",
            "Upper tail: \\(P(X > x)\\)" = "upper.tail",
            "Interval: \\(P(a \\leq X \\leq b)\\)" = "interval"
          )
        )
      ),
      
      conditionalPanel(
        condition = "input.distribution == 'Binomial' && input.lower_tail_binomial == 'lower.tail'",
        numericInput("x1_binomial", "x:",
                     value = 8, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Binomial' && input.lower_tail_binomial == 'upper.tail'",
        numericInput("x2_binomial", "x:",
                     value = 8, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Binomial' && input.lower_tail_binomial == 'interval'",
        numericInput("a_binomial", "a:",
                     value = 8, min = 0, step = 1
        ),
        numericInput("b_binomial", "b: \\( (a \\leq b) \\)",
                     value = 12, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square' && input.lower_tail_chisquare == 'lower.tail'",
        numericInput("x1_chisquare", "x:",
                     value = 9.6, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square' && input.lower_tail_chisquare == 'upper.tail'",
        numericInput("x2_chisquare", "x:",
                     value = 9.6, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square' && input.lower_tail_chisquare == 'interval'",
        numericInput("a_chisquare", "a:",
                     value = 9.6, min = 0, step = 1
        ),
        numericInput("b_chisquare", "b: \\( (a \\leq b) \\)",
                     value = 14.4, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.lower_tail_normal == 'lower.tail'",
        numericInput("x1_normal", "x:",
                     value = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.lower_tail_normal == 'upper.tail'",
        numericInput("x2_normal", "x:",
                     value = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.lower_tail_normal == 'interval'",
        numericInput("a_normal", "a:",
                     value = -1, step = 1
        ),
        numericInput("b_normal", "b: \\( (a \\leq b) \\)",
                     value = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson' && input.lower_tail_poisson == 'lower.tail'",
        numericInput("x1_poisson", "x:",
                     value = 6, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson' && input.lower_tail_poisson == 'upper.tail'",
        numericInput("x2_poisson", "x:",
                     value = 6, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson' && input.lower_tail_poisson == 'interval'",
        numericInput("a_poisson", "a:",
                     value = 6, min = 0, step = 1
        ),
        numericInput("b_poisson", "b: \\( (a \\leq b) \\)",
                     value = 10, min = 0, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t' && input.lower_tail_student == 'lower.tail'",
        numericInput("x1_student", "x:",
                     value = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t' && input.lower_tail_student == 'upper.tail'",
        numericInput("x2_student", "x:",
                     value = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t' && input.lower_tail_student == 'interval'",
        numericInput("a_student", "a:",
                     value = -1, step = 1
        ),
        numericInput("b_student", "b: \\( (a \\leq b) \\)",
                     value = 1, step = 1
        )
      ),
      
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F' && input.lower_tail_f == 'lower.tail'",
        numericInput("x1_f", "x:",
                     value = 1, step = 1)
      ),
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F' && input.lower_tail_f == 'upper.tail'",
        numericInput("x2_f", "x:",
                     value = 1, step = 1
        )
      ),
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F' && input.lower_tail_f == 'interval'",
        numericInput("a_f", "a:",
                     value = 0, step = 1
        ),
        numericInput("b_f", "b: \\( (a \\leq b) \\)",
                     value = 1, step = 1
        )
      ),
      
      hr(),
    ),
    
    # Show a plot of the generated distribution
    mainPanel(
      br(),
      uiOutput("results_distribution"),
      br(),
      conditionalPanel(
        condition = "input.distribution == 'Binomial' && input.lower_tail_binomial == 'lower.tail'",
        plotOutput("binomialPlot_lower")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Binomial' && input.lower_tail_binomial == 'upper.tail'",
        plotOutput("binomialPlot_upper")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Binomial' && input.lower_tail_binomial == 'interval'",
        plotOutput("binomialPlot_interval")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square' && input.lower_tail_chisquare == 'lower.tail'",
        plotOutput("chisquarePlot_lower")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square' && input.lower_tail_chisquare == 'upper.tail'",
        plotOutput("chisquarePlot_upper")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Chi-square' && input.lower_tail_chisquare == 'interval'",
        plotOutput("chisquarePlot_interval")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.lower_tail_normal == 'lower.tail'",
        plotOutput("normalPlot_lower")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.lower_tail_normal == 'upper.tail'",
        plotOutput("normalPlot_upper")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Normal' && input.lower_tail_normal == 'interval'",
        plotOutput("normalPlot_interval")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson' && input.lower_tail_poisson == 'lower.tail'",
        plotOutput("poissonPlot_lower")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson' && input.lower_tail_poisson == 'upper.tail'",
        plotOutput("poissonPlot_upper")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Poisson' && input.lower_tail_poisson == 'interval'",
        plotOutput("poissonPlot_interval")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t' && input.lower_tail_student == 'lower.tail'",
        plotOutput("studentPlot_lower")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t' && input.lower_tail_student == 'upper.tail'",
        plotOutput("studentPlot_upper")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Student t' && input.lower_tail_student == 'interval'",
        plotOutput("studentPlot_interval")
      ),
      
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F' && input.lower_tail_f == 'lower.tail'",
        plotOutput("FPlot_lower")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F' && input.lower_tail_f == 'upper.tail'",
        plotOutput("FPlot_upper")
      ),
      conditionalPanel(
        condition = "input.distribution == 'Snedecor F' && input.lower_tail_f == 'interval'",
        plotOutput("FPlot_interval")
      ),
    )
  )

output$results_distribution <- renderUI({
     if (input$distribution == "Binomial") {
      withMathJax(
        paste0("\\(X \\sim Binomial(n = \\)", " ", input$n_binomial, ", ", "\\(p = \\)", " ", input$p_binomial, "\\()\\)","and ", case_when(
          input$lower_tail_binomial == "lower.tail" ~ paste0("\\(P(X \\leq \\)", " ", input$x1_binomial, "\\()\\)", " ", "\\( = \\)", " ", round(pbinom(input$x1_binomial, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), 4)),
          input$lower_tail_binomial == "upper.tail" ~ paste0("\\(P(X > \\)", " ", input$x2_binomial, "\\()\\)", " ", "\\( = \\)", " ", round(pbinom(input$x2_binomial, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE), 4)),
          input$lower_tail_binomial == "interval" ~ paste0("\\(P(\\)", input$a_binomial, " ", "\\(\\leq X\\leq \\)", " ", input$b_binomial, "\\()\\)", " ", "\\( = \\)", " ", ifelse(input$a_binomial > input$b_binomial, "a must be less than or equal to b", round(pbinom(input$b_binomial, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE) - pbinom(input$a_binomial - 1, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), 4)))
        ))
      )
    } else if (input$distribution == "Chi-square") {
      withMathJax(
        paste0("\\(X \\sim \\chi^2(df = \\)", " ", input$df_chisquare, "\\()\\)", " and ", case_when(
          input$lower_tail_chisquare == "lower.tail" ~ paste0("\\(P(X \\leq \\)", " ", input$x1_chisquare, "\\()\\)", " ", "\\( = \\)", " ", round(pchisq(input$x1_chisquare, df = input$df_chisquare, lower.tail = TRUE), 4)),
          input$lower_tail_chisquare == "upper.tail" ~ paste0("\\(P(X > \\)", " ", input$x2_chisquare, "\\()\\)", " ", "\\( = \\)", " ", round(pchisq(input$x2_chisquare, df = input$df_chisquare, lower.tail = FALSE), 4)),
          input$lower_tail_chisquare == "interval" ~ paste0("\\(P(\\)", input$a_chisquare, " ", "\\(\\leq X\\leq \\)", " ", input$b_chisquare, "\\()\\)", " ", "\\( = \\)", " ", ifelse(input$a_chisquare > input$b_chisquare, "a must be less than or equal to b", round(pchisq(input$b_chisquare, df = input$df_chisquare, lower.tail = TRUE) - pchisq(input$a_chisquare, df = input$df_chisquare, lower.tail = TRUE), 4)))
        ))
      )
    } else if (input$distribution == "Normal") {
      withMathJax(
        paste0("\\(X \\sim Normal(\\mu = \\)", " ", input$mean_normal, ", ", ifelse(input$variance_sd == "variance_true", paste0("\\(\\sigma^2 = \\)", " ", input$variance_normal), paste0("\\(\\sigma^2 = \\)", " ", input$sd_normal^2)), "\\()\\)", " and ", case_when(
          input$lower_tail_normal == "lower.tail" ~ paste0("\\(P(X \\leq \\)", " ", input$x1_normal, "\\()\\)", " ", "\\( = \\)", " ", "\\(P(Z \\leq \\)", " ", "\\((\\)", input$x1_normal, " ", "\\(-\\)", " ", input$mean_normal, "\\()\\)", " ", "\\(/\\)", " ", ifelse(input$variance_sd == "variance_true", round(sqrt(input$variance_normal), 2), input$sd_normal), "\\()\\)", " ", "\\( = \\)", " ", "\\(P(Z \\leq \\)", " ", round((input$x1_normal - input$mean_normal) / ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), 2), "\\()\\)", " ", "\\( = \\)", " ", round(pnorm(input$x1_normal, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = TRUE), 4)),
          input$lower_tail_normal == "upper.tail" ~ paste0("\\(P(X > \\)", " ", input$x2_normal, "\\()\\)", " ", "\\( = \\)", " ", "\\(P(Z > \\)", " ", "\\((\\)", input$x2_normal, " ", "\\(-\\)", " ", input$mean_normal, "\\()\\)", " ", "\\(/\\)", " ", ifelse(input$variance_sd == "variance_true", round(sqrt(input$variance_normal), 2), input$sd_normal), "\\()\\)", " ", "\\( = \\)", " ", "\\(P(Z > \\)", " ", round((input$x2_normal - input$mean_normal) / ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), 2), "\\()\\)", " ", "\\( = \\)", " ", round(pnorm(input$x2_normal, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = FALSE), 4)),
          input$lower_tail_normal == "interval" ~ paste0("\\(P(\\)", input$a_normal, " ", "\\(\\leq X\\leq \\)", " ", input$b_normal, "\\()\\)", " ", "\\( = \\)", " ", "\\(P(\\)", "\\((\\)", input$a_normal, " ", "\\(-\\)", " ", input$mean_normal, "\\()\\)", " ", "\\(/\\)", " ", ifelse(input$variance_sd == "variance_true", round(sqrt(input$variance_normal), 2), input$sd_normal), "\\()\\)", " ", "\\(\\leq Z\\leq \\)", " ", "\\((\\)", input$b_normal, " ", "\\(-\\)", " ", input$mean_normal, "\\()\\)", " ", "\\(/\\)", " ", ifelse(input$variance_sd == "variance_true", round(sqrt(input$variance_normal), 2), input$sd_normal), "\\()\\)", " ", "\\( = \\)", " ","\\(P(\\)", round((input$a_normal - input$mean_normal) / ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), 2), " ", "\\(\\leq Z\\leq \\)", " ", round((input$b_normal - input$mean_normal) / ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), 2), "\\()\\)", " ", "\\( = \\)", " ", ifelse(input$a_normal > input$b_normal, "a must be less than or equal to b", round(pnorm(input$b_normal, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = TRUE) - pnorm(input$a_normal, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = TRUE), 4)))
        ))
      )
    } else if (input$distribution == "Poisson") {
      withMathJax(
        paste0("\\(X \\sim Poisson(\\lambda = \\)", " ", input$lambda_poisson, "\\()\\)", " and ", case_when(
          input$lower_tail_poisson == "lower.tail" ~ paste0("\\(P(X \\leq \\)", " ", input$x1_poisson, "\\()\\)", " ", "\\( = \\)", " ", round(ppois(input$x1_poisson, lambda = input$lambda_poisson, lower.tail = TRUE), 4)),
          input$lower_tail_poisson == "upper.tail" ~ paste0("\\(P(X > \\)", " ", input$x2_poisson, "\\()\\)", " ", "\\( = \\)", " ", round(ppois(input$x2_poisson, lambda = input$lambda_poisson, lower.tail = FALSE), 4)),
          input$lower_tail_poisson == "interval" ~ paste0("\\(P(\\)", input$a_poisson, " ", "\\(\\leq X\\leq \\)", " ", input$b_poisson, "\\()\\)", " ", "\\( = \\)", " ", ifelse(input$a_poisson > input$b_poisson, "a must be less than or equal to b", round(ppois(input$b_poisson, lambda = input$lambda_poisson, lower.tail = TRUE) - ppois(input$a_poisson - 1, lambda = input$lambda_poisson, lower.tail = TRUE), 4)))
        ))
      )
    } else if (input$distribution == "Student t") {
      withMathJax(
        paste0("\\(X \\sim t_{df = }\\)", " ", input$df_student, "\\()\\)", " and ", case_when(
          input$lower_tail_student == "lower.tail" ~ paste0("\\(P(X \\leq \\)", " ", input$x1_student, "\\()\\)", " ", "\\( = \\)", " ", round(pt(input$x1_student, df = input$df_student, lower.tail = TRUE), 4)),
          input$lower_tail_student == "upper.tail" ~ paste0("\\(P(X > \\)", " ", input$x2_student, "\\()\\)", " ", "\\( = \\)", " ", round(pt(input$x2_student, df = input$df_student, lower.tail = FALSE), 4)),
          input$lower_tail_student == "interval" ~ paste0("\\(P(\\)", input$a_student, " ", "\\(\\leq X\\leq \\)", " ", input$b_student, "\\()\\)", " ", "\\( = \\)", " ", ifelse(input$a_student > input$b_student, "a must be less than or equal to b", round(pt(input$b_student, df = input$df_student, lower.tail = TRUE) - pt(input$a_student, df = input$df_student, lower.tail = TRUE), 4)))
        ))
      )
    } else if (input$distribution == "F") {
      withMathJax(
        paste0("\\(X \\sim F_{df1 = }\\)", " ", input$df1_f, "\\()\\)", " and ", case_when(
          input$lower_tail_f == "lower.tail" ~ paste0("\\(P(X \\leq \\)", " ", input$x1_f, "\\()\\)", " ", "\\( = \\)", " ", round(pf(input$x1_f, df1 = input$df1_f,df2=input$df2_f ,lower.tail = TRUE), 4)),
          input$lower_tail_f == "upper.tail" ~ paste0("\\(P(X > \\)", " ", input$x2_f, "\\()\\)", " ", "\\( = \\)", " ", round(pf(input$x1_f, df1 = input$df1_f,df2=input$df2_f, lower.tail = FALSE), 4)),
          input$lower_tail_f == "interval" ~ paste0("\\(P(\\)", input$a_f, " ", "\\(\\leq X\\leq \\)", " ", input$b_f, "\\()\\)", " ", "\\( = \\)", " ", ifelse(input$a_f > input$b_f, "a must be less than or equal to b", round(pf(input$b_f, df1 = input$df1_f,df2=input$df2_f, lower.tail = TRUE) - pf(input$a_f, df1 = input$df1_f,df2=input$df2_f , lower.tail = TRUE), 4)))
        ))
      )  
    } else {
      print("loading...")
    }
  })
output$binomialPlot_lower <- renderPlot({
    p <- data.frame(heads = qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE):qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), prob = dbinom(x = qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE):qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), size = input$n_binomial, prob = input$p_binomial)) %>%
      mutate(Heads = ifelse(heads <= input$x1_binomial, "2", "Other")) %>%
      ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
      geom_col() +
      geom_text(
        aes(label = round(prob, 3), y = prob + 0.005),
        position = position_dodge(0.9),
        size = 3,
        vjust = 0
      ) +
      theme_minimal() +
      theme(legend.position = "none") +
      ggtitle(paste0(input$distribution, " distribution: Binomial(", input$n_binomial, ", ", input$p_binomial, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Probability mass function") +
      xlab("x")
    p
  })
output$binomialPlot_upper <- renderPlot({
    p <- data.frame(heads = qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE):qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), prob = dbinom(x = qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE):qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), size = input$n_binomial, prob = input$p_binomial)) %>%
      mutate(Heads = ifelse(heads > input$x2_binomial, "2", "other")) %>%
      ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
      geom_col() +
      geom_text(
        aes(label = round(prob, 3), y = prob + 0.005),
        position = position_dodge(0.9),
        size = 3,
        vjust = 0
      ) +
      theme_minimal() +
      theme(legend.position = "none") +
      ggtitle(paste0(input$distribution, " distribution: Binomial(", input$n_binomial, ", ", input$p_binomial, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Probability mass function") +
      xlab("x")
    p
  })
output$binomialPlot_interval <- renderPlot({
    p <- data.frame(heads = qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE):qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), prob = dbinom(x = qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = FALSE):qbinom(0.99999, size = input$n_binomial, prob = input$p_binomial, lower.tail = TRUE), size = input$n_binomial, prob = input$p_binomial)) %>%
      mutate(Heads = ifelse(heads >= input$a_binomial & heads <= input$b_binomial, "2", "other")) %>%
      ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
      geom_col() +
      geom_text(
        aes(label = round(prob, 3), y = prob + 0.005),
        position = position_dodge(0.9),
        size = 3,
        vjust = 0
      ) +
      theme_minimal() +
      theme(legend.position = "none") +
      ggtitle(paste0(input$distribution, " distribution: Binomial(", input$n_binomial, ", ", input$p_binomial, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Probability mass function") +
      xlab("x")
    p
  })
  

output$chisquarePlot_lower <- renderPlot({
    funcShaded <- function(x) {
      y <- dchisq(x, df = input$df_chisquare)
      y[x > input$x1_chisquare] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qchisq(0.99999, df = input$df_chisquare, lower.tail = FALSE), qchisq(0.99999, df = input$df_chisquare, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dchisq, args = list(df = input$df_chisquare)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: Chi(", input$df_chisquare, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$chisquarePlot_upper <- renderPlot({
    funcShaded <- function(x) {
      y <- dchisq(x, df = input$df_chisquare)
      y[x < input$x2_chisquare] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qchisq(0.99999, df = input$df_chisquare, lower.tail = FALSE), qchisq(0.99999, df = input$df_chisquare, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dchisq, args = list(df = input$df_chisquare)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: Chi^2(", input$df_chisquare, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$chisquarePlot_interval <- renderPlot({
    funcShaded <- function(x) {
      y <- dchisq(x, df = input$df_chisquare)
      y[x < input$a_chisquare | x > input$b_chisquare] <- NA
      return(y)
    }
   p <- ggplot(data.frame(x = c(qchisq(0.99999, df = input$df_chisquare, lower.tail = FALSE), qchisq(0.99999, df = input$df_chisquare, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dchisq, args = list(df = input$df_chisquare)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: Chi^2(", input$df_chisquare, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
  

output$normalPlot_lower <- renderPlot({
    funcShaded <- function(x) {
      y <- dnorm(x,
                 mean = input$mean_normal,
                 sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal)
      )
      y[x > input$x1_normal] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qnorm(0.99999, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = FALSE), qnorm(0.99999, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dnorm, args = list(
        mean = input$mean_normal,
        sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal)
      )) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: Normal(", input$mean_normal, ", ", ifelse(input$variance_sd == "variance_true", input$variance_normal, (input$sd_normal^2)), ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$normalPlot_upper <- renderPlot({
    funcShaded <- function(x) {
      y <- dnorm(x,
                 mean = input$mean_normal,
                 sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal)
      )
      y[x < input$x2_normal] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qnorm(0.99999, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = FALSE), qnorm(0.99999, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dnorm, args = list(
        mean = input$mean_normal,
        sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal)
      )) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: Normal(", input$mean_normal, ", ", ifelse(input$variance_sd == "variance_true", input$variance_normal, (input$sd_normal^2)), ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$normalPlot_interval <- renderPlot({
    funcShaded <- function(x) {
      y <- dnorm(x,
                 mean = input$mean_normal,
                 sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal)
      )
      y[x < input$a_normal | x > input$b_normal] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qnorm(0.99999, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = FALSE), qnorm(0.99999, mean = input$mean_normal, sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal), lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dnorm, args = list(
        mean = input$mean_normal,
        sd = ifelse(input$variance_sd == "variance_true", sqrt(input$variance_normal), input$sd_normal)
      )) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: Normal(", input$mean_normal, ", ", ifelse(input$variance_sd == "variance_true", input$variance_normal, (input$sd_normal^2)), ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
  
output$poissonPlot_lower <- renderPlot({
    p <- data.frame(heads = qpois(0.99999, lambda = input$lambda_poisson, lower.tail = FALSE):qpois(0.99999, lambda = input$lambda_poisson, lower.tail = TRUE), prob = dpois(x = qpois(0.99999, lambda = input$lambda_poisson, lower.tail = FALSE):qpois(0.99999, lambda = input$lambda_poisson, lower.tail = TRUE), lambda = input$lambda_poisson)) %>%
      mutate(Heads = ifelse(heads <= input$x1_poisson, "2", "Other")) %>%
      ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
      geom_col() +
      geom_text(
        aes(label = round(prob, 3), y = prob + 0.005),
        position = position_dodge(0.9),
        size = 3,
        vjust = 0
      ) +
      theme_minimal() +
      theme(legend.position = "none") +
      ggtitle(paste0(input$distribution, " distribution: Poisson(", input$lambda_poisson, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Probability mass function") +
      xlab("x")
    p
  })
output$poissonPlot_upper <- renderPlot({
    p <- data.frame(heads = qpois(0.99999, lambda = input$lambda_poisson, lower.tail = FALSE):qpois(0.99999, lambda = input$lambda_poisson, lower.tail = TRUE), prob = dpois(x = qpois(0.99999, lambda = input$lambda_poisson, lower.tail = FALSE):qpois(0.99999, lambda = input$lambda_poisson, lower.tail = TRUE), lambda = input$lambda_poisson)) %>%
      mutate(Heads = ifelse(heads > input$x2_poisson, "2", "other")) %>%
      ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
      geom_col() +
      geom_text(
        aes(label = round(prob, 3), y = prob + 0.005),
        position = position_dodge(0.9),
        size = 3,
        vjust = 0
      ) +
      theme_minimal() +
      theme(legend.position = "none") +
      ggtitle(paste0(input$distribution, " distribution: Poisson(", input$lambda_poisson, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Probability mass function") +
      xlab("x")
    p
  })
output$poissonPlot_interval <- renderPlot({
    p <- data.frame(heads = qpois(0.99999, lambda = input$lambda_poisson, lower.tail = FALSE):qpois(0.99999, lambda = input$lambda_poisson, lower.tail = TRUE), prob = dpois(x = qpois(0.99999, lambda = input$lambda_poisson, lower.tail = FALSE):qpois(0.99999, lambda = input$lambda_poisson, lower.tail = TRUE), lambda = input$lambda_poisson)) %>%
      mutate(Heads = ifelse(heads >= input$a_poisson & heads <= input$b_poisson, "2", "other")) %>%
      ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
      geom_col() +
      geom_text(
        aes(label = round(prob, 3), y = prob + 0.005),
        position = position_dodge(0.9),
        size = 3,
        vjust = 0
      ) +
      theme_minimal() +
      theme(legend.position = "none") +
      ggtitle(paste0(input$distribution, " distribution: Poisson(", input$lambda_poisson, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Probability mass function") +
      xlab("x")
    p
  })
  
output$studentPlot_lower <- renderPlot({
    funcShaded <- function(x) {
      y <- dt(x, df = input$df_student)
      y[x > input$x1_student] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qt(0.99999, df = input$df_student, lower.tail = FALSE), qt(0.99999, df = input$df_student, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dt, args = list(df = input$df_student)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: t(", input$df_student, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$studentPlot_upper <- renderPlot({
    funcShaded <- function(x) {
      y <- dt(x, df = input$df_student)
      y[x < input$x2_student] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qt(0.99999, df = input$df_student, lower.tail = FALSE), qt(0.99999, df = input$df_student, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dt, args = list(df = input$df_student)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: t(", input$df_student, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$studentPlot_interval <- renderPlot({
    funcShaded <- function(x) {
      y <- dt(x, df = input$df_student)
      y[x < input$a_student | x > input$b_student] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qt(0.99999, df = input$df_student, lower.tail = FALSE), qt(0.99999, df = input$df_student, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = dt, args = list(df = input$df_student)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: t(", input$df_student, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })

output$FPlot_lower <- renderPlot({
    funcShaded <- function(x) {
      y <- df(x, df1 = input$df1_f,df2 = input$df2_f)
      y[x > input$x1_f] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qf(0.99999, df1 = input$df1_f,df2=input$df2_f, lower.tail = FALSE), qf(0.99999, df1 = input$df1_f,df2=input$df2_f, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = df, args = list(df1 = input$df1_f,df2=input$df2_f)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: f(", input$df1_f,",",input$df2_f, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$FPlot_upper <- renderPlot({
    funcShaded <- function(x) {
      y <- df(x, df1 = input$df1_f,df2 = input$df2_f)
      y[x < input$x2_f] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qf(0.99999, df1 = input$df1_f,df2=input$df2_f, lower.tail = FALSE), qf(0.99999, df1 = input$df1_f,df2=input$df2_f, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = df, args = list(df1 = input$df1_f,df2=input$df2_f)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: f(", input$df1_f,",",input$df2_f, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
  })
output$FPlot_interval <- renderPlot({
    funcShaded <- function(x) {
      y <- df(x, df1 = input$df1_f,df2 = input$df2_f)
      y[x < input$a_f | x > input$b_f] <- NA
      return(y)
    }
    p <- ggplot(data.frame(x = c(qf(0.99999, df1 = input$df1_f,df2=input$df2_f, lower.tail = FALSE), qf(0.99999, df1 = input$df1_f,df2=input$df2_f, lower.tail = TRUE))), aes(x = x)) +
      stat_function(fun = df, args = list(df1 = input$df1_f,df2=input$df2_f)) +
      stat_function(fun = funcShaded, geom = "area", alpha = 0.8) +
      theme_minimal() +
      ggtitle(paste0(input$distribution, " distribution: f(", input$df1_f,",",input$df2_f, ")")) +
      theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
      ylab("Density") +
      xlab("x")
    p
    
  })

```

